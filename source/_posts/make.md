---
title: make
date: 2024-02-29 19:58:52
tags:
- make
description: 
---

#### 链接

https://www.ruanyifeng.com/blog/2015/02/make.html

#### 简介

make只是一个根据指定的Shell命令进行构建的工具。它的规则很简单，你规定要构建哪个文件、它依赖哪些源文件，当那些文件有变动时，如何重新构建它。

#### 文件格式

Makefile 文件由一系列的规则（rules）组成，每一条规则的形式如下：

```
<target>: <prerequisites>
[tab] <commands>
```

目标是必需的，我们不可以省略。前置条件和命令是可选的，但是两者之中最少存在一个。

##### 目标 target

一个目标（target）就构成一条规则。目标通常是文件名，指明 Make 需要构建的对象。target 可以是一个文件名，也可以是多个文件名，中间需要使用空格分隔。

除了文件名，也可以是某个操作的名字，这称为「伪目标」（phony target）。比如说

```
clean:
    rm *.o
```

但是如果当前目录中恰好有一个文件叫做 clean，那么这个命令就不会执行。因为Make发现clean文件已经存在，就认为没有必要重新构建了，就不会执行指定的rm命令。

为了避免这种情况，可以明确声明clean是"伪目标"，写法如下。

```
.PHONY: clean
clean:
        rm *.o temp
```

##### 前置条件 prerequisite

前置条件通常是一组文件名，之间用空格分隔。它指定了"目标"是否重新构建的判断标准：只要有一个前置文件不存在，或者有过更新（前置文件的last-modification时间戳比目标的时间戳新），"目标"就需要重新构建。

##### 命令 commands

命令 commands 表示如何更新目标，由一行或者多行的 shell 命令组成。是构建目标的具体指令，运行结果通常就是生成文件。

需要注意的是，每行命令在一个单独的shell中执行。这些Shell之间没有继承关系。如果我们想前后有一些关系，需要把他们写在一行，中间使用分号隔开。另一个解决办法就是在换行符前面加 \ 反斜杠进行转义。

#### Makefile 语法

##### 注释

makefile 文件使用 # 注释。

##### 回声

正常条件下，makefile 会打印每一条指令， 然后再执行，这就是回声（echoing）。在指令的前面加上 @ 就可以关闭回声（注释也会回声）。由于在构建过程中，需要了解当前在执行哪条命令，所以通常只在注释和纯显示的echo命令前面加上@。

##### 模式匹配

Make命令允许对文件名，进行类似正则运算的匹配，主要用到的匹配符是%。

##### 变量和赋值符

Makefile 允许使用等号自定义变量。调用Shell变量，需要在美元符号前，再加一个美元符号，这是因为Make命令会对美元符号转义。

##### 循环和判断

##### 函数



