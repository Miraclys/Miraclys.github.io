---
title: 操作系统
date: 2024-02-26 16:06:12
tags: 
- Operating System
description: lecture notes in operatring system. 
---

### 操作系统发展史

#### 第一代计算机：真空管和穿孔卡片

第一代计算机的产生是由机械时代进入电子时代的标志，第二次世界大战刺激了有关计算机研究的爆炸性进展。

此时，没有操作系统的概念，所有的程序设计都是直接操控硬件。程序员将拿着插板到机房里，几个小时独享计算机资源。程序是串行的。

#### 第二代计算机：晶体管和批处理系统

当时计算机很昂贵，自然想减少机时的浪费，通常采用的就是批处理系统（Batch System）。

用户将作业交给系统操作员，系统操作员将许多用户的作业组成一批作业（job）之后输入到计算机中。在系统中形成一个自动转接的连续的作业流。最后，由操作员将作业结果交给用户。

#### 第三代计算机：集成电路芯片和多道程序设计

多道技术的实现是为了解决多个程序竞争或者说共享一个资源（比如 CPU）的有序调度问题，解决方式基多路复用，分为时间和空间上的复用。

1. 时间上的复用。一个程序进行 IO 的时候，CPU 执行另一个程序
2. 空间上的复用。同一时间多个程序进入内存，硬件层面提供保护机制来确保各自的内存是分割开的，且由操作系统来操控，这样不需要一个一个程序排队进入内存。

分时系统（Time Sharing System）。在分时系统中，计算机会轮流为多个用户提供服务，每个用户似乎都在独占地使用整个系统。这是通过快速地在不同用户之间进行切换来实现的，使得每个用户都感觉到自己在独占使用系统（感觉类似于现在的服务器，多人使用）。

它将 CPU 时间划分为若干个片段，称为「时间片」（time slice）。操作系统以时间片为单位，轮流为每个终端用户提供服务。

#### 第四代计算机：个人计算机（PC）

个人计算机（Personal Computer，PC）

### Introduction

电脑系统是由硬件、操作系统、应用程序和用户四个部分组成的。

操作系统是什么？两个视角
1. User View. 执行用户程序，使得解决用户问题更加简单。
2. System View. 操作系统是一个资源分配器，管理所有的资源。

#### Computer Startup

启动的四个阶段：

1. BIOS
    随着 ROM（Read-Only Memory，ROM）发明，开机程序被刷入 ROM 芯片，计算机通电以后，第一件事就是执行它，这块 ROM 芯片里面的程序叫做「基本输入输出系统」（Basic Input/Output System），简称 BIOS。
2. 硬件自检
    BIOS 首先检查硬件，开是否符合开机的基本条件，叫做「硬件自检」（Power-On Self Test，POST）。如果硬件出现问题，主板会发出不同含义的蜂鸣。自检完成以后。BIOS 将控制权交给下一个阶段的启动程序。
3. 主引导记录
    BIOS 按照启动顺序，把控制权交给排在第一位的存储设备。
    这时，计算机读取该设备的第一个扇区，也就是读取最前面的512个字节。如果这512个字节的最后两个字节是0x55和0xAA，表明这个设备可以用于启动；如果不是，表明设备不能用于启动，控制权于是被转交给"启动顺序"中的下一个设备。
    最前面的 512 个字节叫做「主引导记录」（Master Boot Record，MBR）
    其中，"主引导记录"只有512个字节，放不了太多东西。它的主要作用是，告诉计算机到硬盘的哪一个位置去找操作系统。
    主引导记录的三个组成部分：
    1. 1-446. 调用操作系统的操作码
    2. 447-510. 分区表（Partition table）
    3. 511-512. 主引导记录签名（0x55 和 0xAA）
    其中，分区表是 64 位，里面又分为 4 项，每一项是 16 字节。所以，一个硬盘最多分为 4 个一级分区，又叫做「主分区」？？？
4. 硬盘启动
    这时，计算机的控制权交给某一个分区，这里又分为三种情况
    1. 卷引导记录
        四个主分区里面，只有一个是激活的。计算机会读取激活分区的第一个扇区，叫做"卷引导记录"（Volume boot record，缩写为VBR）。
    2. 扩展分区和逻辑分区
        随着硬盘越来越大，四个主分区已经不够了，需要更多的分区。但是，分区表只有四项，因此规定有且仅有一个区可以被定义成"扩展分区"（Extended partition）。
        所谓"扩展分区"，就是指这个区里面又分成多个区。这种分区里面的分区，就叫做"逻辑分区"（logical partition）。
    3. 启动管理器
        在这种情况下，计算机读取"主引导记录"前面446字节的机器码之后，不再把控制权转交给某一个分区，而是运行事先安装的"启动管理器"（boot loader），由用户选择启动哪一个操作系统。
5. 操作系统
    控制权被交给操作系统，操作系统的内核首先被载入内存。

> 在计算机启动过程中，BIOS会执行自检（POST），然后检查存储设备，找到可引导的设备。接着，它会读取该设备的主引导记录（MBR）（如果我们是 Windows 系统，这一个 MBR 独立于任何C、D、E类的盘），根据不同的盘搜索引导标记，并将控制权转交给含有引导标记的分区。这个分区中存储着引导加载程序（bootloader），它会加载操作系统的核心文件到内存中，并将控制权传递给操作系统，从而启动了操作系统。

##### 链接

1. https://pshizhsysu.gitbook.io/installation-of-os
2. https://www.ruanyifeng.com/blog/2013/02/booting.html

#### C 语言中的系统调用

C语言提供的库函数和系统调用之间有密切的关系。通常情况下，C语言的库函数会封装操作系统提供的系统调用，使得程序员可以更方便地使用这些功能而不必直接与系统调用接口交互。



---

### 杂记

开机的四个阶段：

1. 加电后执行 BIOS 中的固化程序
2. BIOS 

什么是硬盘分区

操作系统发展史

BIOS 提出

DOS

活动分区 引导代码 BIOS boot sector format 命令 关系

活动分区的引导扇区 汇编写一个？

操作系统需要对文件系统很了解

freopen 是一个库函数，内部有对于系统的调用，实现读写

分时系统 操作系统是中断驱动？

CPU 的两个工作模式，实现操作系统的安全

开机的讲解 blog https://www.ruanyifeng.com/blog/2013/02/booting.html

UEFI 和 BIOS 之间的区别？关系？

PC-DOS、MS-DOS 单用户、单任务？

现在的计算机是多道程序设计？

为了避免应用程序访问一些 。。。 CPU 中设计了 Privileged Instructions

CPU 有两种状态/模式

函数库（一个封装，上层的 C 语言是一样的）在不同的操作系统下不一样，这也就是我们下载的时候包不一样

好好理解一下 CPU 的两个态

管道、共享内存、messgae

操作系统提供了一些服务，一些是为了用户，一些是为了管理资源

Unix 操作系统设计

C 语言中参数压栈？穿参在系统调用有一个很好的解释？

Xv6 Nachos 课设

C 中的 sin 函数是如何实现的？

驱动？

架构依赖代码 Windows NT 中称为 HAL

宏内核 - 微内核

https://www.v2ex.com/t/1019215#reply18

Java 虚拟机 - 虚拟机

